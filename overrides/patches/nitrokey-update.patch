From cac193b60efbceb142dea8b52549f1a05750685c Mon Sep 17 00:00:00 2001
From: Johannes Schleifenbaum <johannes@js-webcoding.de>
Date: Thu, 13 Oct 2022 15:42:05 +0200
Subject: [PATCH 1/4] python3Packages.click-command-tree: init at 1.1.0

---
 .../click-command-tree/default.nix            | 51 +++++++++++++++++++
 pkgs/top-level/python-packages.nix            |  2 +
 2 files changed, 53 insertions(+)
 create mode 100644 pkgs/development/python-modules/click-command-tree/default.nix

diff --git a/pkgs/development/python-modules/click-command-tree/default.nix b/pkgs/development/python-modules/click-command-tree/default.nix
new file mode 100644
index 0000000000000..1fd10c9bfd953
--- /dev/null
+++ b/pkgs/development/python-modules/click-command-tree/default.nix
@@ -0,0 +1,51 @@
+{ lib
+, buildPythonPackage
+, pythonOlder
+, fetchpatch
+, fetchFromGitHub
+, click
+, pytestCheckHook
+}:
+
+buildPythonPackage rec {
+  pname = "click-command-tree";
+  version = "1.1.0";
+  format = "setuptools";
+  disabled = pythonOlder "3.4";
+
+  src = fetchFromGitHub {
+    owner = "whwright";
+    repo = "click-command-tree";
+    rev = version;
+    sha256 = "sha256-vFOcn+ibyLZnhU3OQMtnHI04UqAY2/CCvhq4EEU4XFo=";
+  };
+
+  patches = [
+    # disable flake8 linting - https://github.com/whwright/click-command-tree/issues/4
+    (fetchpatch {
+      url = "https://github.com/whwright/click-command-tree/commit/1ecfcfa29bf01e1131e6ec712bd7338ac1283dc8.patch";
+      sha256 = "sha256-u5jsNfEo1+XNlkVGPCM/rsDPnYko6cr2z2si9nq+sLA=";
+    })
+  ];
+
+  propagatedBuildInputs = [
+    click
+  ];
+
+  checkInputs = [
+    pytestCheckHook
+  ];
+
+  pytestFlagsArray = [ "tests.py" ];
+
+  pythonImportsCheck = [
+    "click_command_tree"
+  ];
+
+  meta = with lib; {
+    description = "click plugin to show the command tree of your CLI";
+    homepage = "https://github.com/whwright/click-command-tree";
+    license = licenses.mit;
+    maintainers = with maintainers; [ jojosch ];
+  };
+}
diff --git a/pkgs/top-level/python-packages.nix b/pkgs/top-level/python-packages.nix
index b49f7e43e1b06..b9b2ee2d4a0c4 100644
--- a/pkgs/top-level/python-packages.nix
+++ b/pkgs/top-level/python-packages.nix
@@ -1859,6 +1859,8 @@ in {
 
   clickclick = callPackage ../development/python-modules/clickclick { };
 
+  click-command-tree = callPackage ../development/python-modules/click-command-tree { };
+
   click-completion = callPackage ../development/python-modules/click-completion { };
 
   click-configfile = callPackage ../development/python-modules/click-configfile { };

From a46a37c4675c6e437a5891120339e966253c1e28 Mon Sep 17 00:00:00 2001
From: Johannes Schleifenbaum <johannes@js-webcoding.de>
Date: Thu, 13 Oct 2022 15:44:21 +0200
Subject: [PATCH 2/4] nrfutil: fix build

---
 pkgs/development/tools/misc/nrfutil/default.nix | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/pkgs/development/tools/misc/nrfutil/default.nix b/pkgs/development/tools/misc/nrfutil/default.nix
index 7d2cbabef40e5..07b14380f3395 100644
--- a/pkgs/development/tools/misc/nrfutil/default.nix
+++ b/pkgs/development/tools/misc/nrfutil/default.nix
@@ -2,6 +2,7 @@
 , stdenv
 , fetchFromGitHub
 , python3
+, protobuf3_20
 }:
 
 with python3.pkgs;
@@ -25,7 +26,10 @@ buildPythonApplication rec {
     intelhex
     pc-ble-driver-py
     piccata
-    protobuf
+    # ERROR: Could not find a version that satisfies the requirement protobuf<4.0.0,>=3.17.3 (from nrfutil) (from versions: none)
+    (protobuf.override {
+      protobuf = protobuf3_20;
+    })
     pyserial
     pyspinel
     pyyaml

From eb5869d7c42394df38dc46fefa6c27cd6e956160 Mon Sep 17 00:00:00 2001
From: Johannes Schleifenbaum <johannes@js-webcoding.de>
Date: Thu, 13 Oct 2022 15:45:10 +0200
Subject: [PATCH 3/4] python3Packages.spsdk: 1.6.3 -> 1.7.1

---
 pkgs/development/python-modules/spsdk/default.nix | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/pkgs/development/python-modules/spsdk/default.nix b/pkgs/development/python-modules/spsdk/default.nix
index ce566fb94a896..9e253c655ad29 100644
--- a/pkgs/development/python-modules/spsdk/default.nix
+++ b/pkgs/development/python-modules/spsdk/default.nix
@@ -9,6 +9,7 @@
 , bincopy
 , bitstring
 , click
+, click-command-tree
 , click-option-group
 , cmsis-pack-manager
 , commentjson
@@ -33,13 +34,13 @@
 
 buildPythonPackage rec {
   pname = "spsdk";
-  version = "1.6.3";
+  version = "1.7.1";
 
   src = fetchFromGitHub {
     owner = "NXPmicro";
     repo = pname;
     rev = version;
-    sha256 = "sha256-JMhd2XdbjEN6SUzFgcBHd/dStiuYeXXis6pfijSfUso=";
+    sha256 = "sha256-JsnypS/C5BBUntQq1nLdMNanqrtOv8uMXIX3vy2PsNw=";
   };
 
   patches = [
@@ -49,11 +50,10 @@ buildPythonPackage rec {
       url = "https://github.com/NXPmicro/spsdk/commit/a85b854de1093de593d27fa64de442224ab2e0fd.patch";
       sha256 = "sha256-4pXV/8RaNuGl7KNdoGD/8YnPQ2ZmUQOjXWA/Yy0Kxu8=";
     })
-    # https://github.com/NXPmicro/spsdk/pull/41
+    # https://github.com/NXPmicro/spsdk/pull/51
     (fetchpatch {
-      name = "blhost-click-8-1-compat.patch";
-      url = "https://github.com/NXPmicro/spsdk/commit/5112b1b69aa681d265035475e73d28ea0c8cb6ab.patch";
-      sha256 = "sha256-Okz6Er6OVuAA5IlB5IabSa/gUSLa+E2Ltd+J3uoIg6o=";
+      url = "https://github.com/NXPmicro/spsdk/commit/75dcdf3a975cd27d43c65d267afdddc9d6556026.patch";
+      sha256 = "sha256-QoLPooYtyAngCRcGTb41oJickENYxx0aftp/5MvTN84=";
     })
   ];
 
@@ -74,6 +74,7 @@ buildPythonPackage rec {
     bincopy
     bitstring
     click
+    click-command-tree
     click-option-group
     cmsis-pack-manager
     commentjson

From e9ea292295387a3c2fcc4ff18df1e5e31c2b612c Mon Sep 17 00:00:00 2001
From: Johannes Schleifenbaum <johannes@js-webcoding.de>
Date: Thu, 13 Oct 2022 15:45:27 +0200
Subject: [PATCH 4/4] pynitrokey: 0.4.27 -> 0.4.30

---
 pkgs/tools/security/pynitrokey/default.nix | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/pkgs/tools/security/pynitrokey/default.nix b/pkgs/tools/security/pynitrokey/default.nix
index 1f36eda5ab3d5..b07b59d415606 100644
--- a/pkgs/tools/security/pynitrokey/default.nix
+++ b/pkgs/tools/security/pynitrokey/default.nix
@@ -4,12 +4,12 @@ with python3Packages;
 
 buildPythonApplication rec {
   pname = "pynitrokey";
-  version = "0.4.27";
+  version = "0.4.30";
   format = "flit";
 
   src = fetchPypi {
     inherit pname version;
-    sha256 = "sha256-aWQhMvATcDtyBtj38mGnypkKIqKQgneBzWDh5o/5Wkc=";
+    sha256 = "sha256-JmvA8Z1oFOP62TpJ0g7VO5hq3YS3/DFB/BKt2o79AOE=";
   };
 
   propagatedBuildInputs = [
